window.addEventListener("load",function(){var e=new Stats;e.showPanel(0),document.body.appendChild(e.dom);var t,r,a,i,n,s,o,h,d;Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)};var l=function(e,t,r){return(e-t)/(r-t)},u=function(e,t){for(var r=Math.abs(t[0]-e),a=0,i=1;i<t.length;i++){var n=Math.abs(t[i]-e);n<r&&(a=i,distance=-n)}return t[a]},v=[{h:216,s:.5,v:.4},{h:.175*360,s:.4,v:.45},{h:67.32,s:.5,v:.5},{h:72,s:.65,v:.5},{h:90,s:.65,v:.5},{h:79.2,s:.65,v:.5},{h:72,s:.65,v:.5},{h:72,s:.5,v:.5},{h:54,s:.45,v:.5},{h:54,s:.25,v:.5},{h:54,s:0,v:.9}],c={nbrVertices:250,nbrVerticesX:500,nbrVerticesY:500,nbrVerticesZ:500,nbrCloud:100,totVertices:this.nbrVerticesX*this.nbrVerticesY*this.nbrVerticesZ,radius:100*Math.random()+100,initPos:[],octave:400*Math.random()+100,amplitude:1,noiseIteration:Math.ceil(4*Math.random()),turbPos:[],turbColor:[],seaLevel:Math.random()/3,mountainLevel:Math.random()/3+1/3,poleSize:200*Math.random()+50,colorSurface:{},ArrayIndex:[0,1,2,3,4,5,6,7,8,9,10],create:function(){var e=Object.create(this);return e.setCubeMesh(),e},setCLoud:function(){t=new THREE.Geometry,r=new THREE.PointsMaterial({size:25}),a=new THREE.Points(t,r);for(var e=0;e<this.nbrCloud;e++){var i=2*Math.random()-1,n=2*Math.random()-1,s=2*Math.random()-1,o=Math.sqrt(i*i+n*n+s*s),h=i/o*(this.radius+10),d=n/o*(this.radius+10),l=s/o*(this.radius+10),u=new THREE.Vector3(h,d,l);t.vertices.push(u)}f.add(a)},setCubeMesh:function(){i=new THREE.BoxGeometry(this.radius,this.radius,this.radius,this.nbrVerticesX,this.nbrVerticesY,this.nbrVerticesZ);for(var e=0;e<i.vertices.length;e++){var t=i.vertices[e];this.initPos.push({_X:t.x,_Y:t.y,_Z:t.z})}for(var r=0;r<i.faces.length;r++)for(var a=0;a<3;a++){var o=new THREE.Color(15856113);i.faces[r].vertexColors[a]=o}n=new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors,wireframe:!1,shading:THREE.FlatShading,shininess:0}),s=new THREE.Mesh(i,n),f.add(s)},setSphere:function(){i=new THREE.SphereGeometry(this.radius,this.nbrVertices,this.nbrVertices);for(var e=0;e<i.vertices.length;e++){var t=i.vertices[e];this.initPos.push({_X:t.x,_Y:t.y,_Z:t.z})}for(var r=0;r<i.faces.length;r++)for(var a=0;a<3;a++){var o=new THREE.Color(15856113);i.faces[r].vertexColors[a]=o}n=new THREE.MeshPhongMaterial({vertexColors:THREE.VertexColors,wireframe:!1,shading:THREE.SmoothShading,shininess:0}),s=new THREE.Mesh(i,n),f.add(s)},spherizer:function(e,t,r){var a=this.radius;lengthSphere=Math.sqrt(e*e+t*t+r*r);var i=e/lengthSphere*a,n=t/lengthSphere*a,s=r/lengthSphere*a;return this.initPos.push({_X:i,_Y:n,_Z:s}),{_X:i,_Y:n,_Z:s}},turbCoord:function(){this.turbPos=[],this.turbColor=[];for(var e=0;e<this.initPos.length;e++){for(var t=this.initPos[e],r=(NoiseY=NoiseZ=1,this.noiseIteration),a=this.octave,i=2,n=storeNoiseY=storeNoiseZ=0,s=0;s<r;s++){var o=(noise.simplex3(p/a,t._Y/a,t._Z/a)+1)/2,h=(noise.simplex3(t._X/a,p/a,t._Z/a)+1)/2,d=(noise.simplex3(t._X/a,t._Y/a,p/a)+1)/2;n+=(o+h+d)/3,storeNoiseY+=(o+h+d)/3,storeNoiseZ+=(o+h+d)/3,a/=i}var l=n/r,u=storeNoiseY/r,v=(storeNoiseZ/r,l*u*u);o=(noise.simplex3(p/a,t._Y/a,t._Z/a)+1)/2,h=(noise.simplex3(t._X/a,p/a,t._Z/a)+1)/2,d=(noise.simplex3(t._X/a,t._Y/a,p/a)+1)/2;var c=this.riverSystem(o,h,d),m=this.poleWeight(t._Y,v);v+=v>this.seaLevel&&v<this.mountainLevel?c:0,v+=m,m*=v,c*=v;var f=this.equateur(t._Y,v)+v;this.turbColor.push({LandSea:v,Pole:m,Deform:c,Equateur:f})}},poleWeight:function(e,t){var r=1;return e>this.radius-this.poleSize*t&&(r=l(e,this.radius-this.poleSize*t,this.radius)),e<this.radius-this.poleSize*t&&(r=0),e<this.radius*-1+this.poleSize*t&&(r=l(e,this.radius*-1+this.poleSize*t,this.radius*-1)),r},equateur:function(e){var t=1;return e>0&&(t=1-l(e,0,this.radius)),e<0&&(t=1-l(e,0,-this.radius)),t},riverSystem:function(e,t,r){var a=Math.abs(e-.5)*Math.abs(t-.5)*Math.abs(r-.5)*6;return a},changeColor:function(){var e,t,r,a=["a","b","c"];this.colorSurface={},this.colorSurface={Hue:this.arrayHue,Sat:this.arraySat,Lum:this.arrayLum};for(var n=0;n<i.faces.length;n++){for(var s=totSat=totLum=0,o=0;o<3;o++){var h=i.faces[n][a[o]];e=.5,t=.5,r=.5;var d=this.turbColor[h].LandSea,c=l(d,this.seaLevel,this.mountainLevel),m=u(10*c,this.ArrayIndex);0==m&&(c=0),c>=this.mountainLevel&&(c=this.mountainLevel);var p=c>this.seaLevel?.6-this.turbColor[h].Equateur/2+.2:v[m].h/360;s+=(v[m].h/360+p)/2,totSat+=v[m].s,totLum+=v[m].v,this.displacement(h,c)}s/=3,totSat/=3,totLum/=3,i.faces[n].vertexColors[0].setHSL(s,totSat,totLum),i.faces[n].vertexColors[1].setHSL(s,totSat,totLum),i.faces[n].vertexColors[2].setHSL(s,totSat,totLum)}},displacement:function(e,t){var r=this.initPos[e],a=t/this.radius*r._X,n=t/this.radius*r._Y,s=t/this.radius*r._Z,o=r._X+a*this.amplitude,h=r._Y+n*this.amplitude,d=r._Z+s*this.amplitude;i.vertices[e].x=o,i.vertices[e].y=h,i.vertices[e].z=d},distanceFromCam:function(){}},m={nbrStars:500,create:function(){o=new THREE.Geometry,h=new THREE.PointsMaterial({size:3,fog:!1}),d=new THREE.Points(o,h);for(var e=0;e<this.nbrStars;e++){var t=2*Math.random()-1,r=2*Math.random()-1,a=2*Math.random()-1,i=Math.sqrt(t*t+r*r+a*a),n=500*Math.random()+1e3,s=t/i*(n+10),l=r/i*(n+10),u=a/i*(n+10),v=new THREE.Vector3(s,l,u);o.vertices.push(v)}f.add(d)}},p=1e3*Math.random();noise.seed(Math.random());var f=new THREE.Scene,E=new THREE.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,1500);f.fog=new THREE.FogExp2(3,.0025),E.position.z=300;var S=new THREE.WebGLRenderer({alpha:!0,antialias:!1});S.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(S.domElement);var b=new THREE.OrbitControls(E,S.domElement);b.enableDamping=!0,b.dampingFactor=.25,b.enableZoom=!0,f.add(new THREE.AmbientLight(11184810));var g=new THREE.DirectionalLight(16777215,1);g.position.set(20,5,10),f.add(g),theStars=m.create(),thePlanet=c.create();var C=function(){thePlanet.turbCoord(),thePlanet.changeColor(),s.geometry.verticesNeedUpdate=!0,s.geometry.colorsNeedUpdate=!0},w=function(){requestAnimationFrame(w),b.update(),e.begin(),S.render(f,E),e.end()};C(),w();var M={Seed:function(){noise.seed(Math.random()),C()}},H=new dat.GUI;H.add(M,"Seed");var P=H.addFolder("Relief");P.add(thePlanet,"octave").min(0).max(500).step(1).onChange(function(e){thePlanet.octave=e,C()}),P.add(thePlanet,"amplitude",-100,100).onChange(function(e){thePlanet.amplitude=e,C()}),P.add(thePlanet,"noiseIteration").min(1).max(10).step(1).onChange(function(e){thePlanet.noiseIteration=e,C()}),P.add(thePlanet,"seaLevel",0,1).onChange(function(e){thePlanet.seaLevel=e,C()}),P.add(thePlanet,"mountainLevel",0,1).onChange(function(e){thePlanet.mountainLevel=e,C()}),P.add(thePlanet,"poleSize",-1e3,1e3).onChange(function(e){thePlanet.poleSize=e,C()});for(var _=H.addFolder("Color"),L=0;L<v.length;L++)_.addColor(v,L).onChange(function(e){C(),console.log(v)})});